<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>ASP.NET Core WebAPI Payload Logging with Serilog | Ranbook Cloud</title>
<meta name="keywords" content="aspdotnetcore, .net, c#, serilog, http, logging, dotnet, api, microsoft">
<meta name="description" content="What Imagine debugging a tricky API integration where you&rsquo;re getting intermittent errors. You suspect the data being sent is the culprit, but you&rsquo;re flying blind. Wouldn&rsquo;t it be great if you could see exactly what&rsquo;s going over the wire?.
In this article, we will look at how to create structured log events for HTTP API request/response transactions in an ASP.NET Core Web API using the Serilog logger and the HTTP Logging Middleware provided by Microsoft.">
<meta name="author" content="Imran">
<link rel="canonical" href="https://ranbook.cloud/posts/serilog-http-payload-logging/">
<meta name="google-site-verification" content="G-FZT5LNGFY4">
<link crossorigin="anonymous" href="/assets/css/stylesheet.css" rel="preload stylesheet" as="style">
<link rel="icon" href="https://ranbook.cloud/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://ranbook.cloud/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://ranbook.cloud/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://ranbook.cloud/apple-touch-icon.png">
<link rel="mask-icon" href="https://ranbook.cloud/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://ranbook.cloud/posts/serilog-http-payload-logging/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
  
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-FZT5LNGFY4"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-FZT5LNGFY4');
        }
      </script>
    
  

<meta property="og:title" content="ASP.NET Core WebAPI Payload Logging with Serilog" />
<meta property="og:description" content="What Imagine debugging a tricky API integration where you&rsquo;re getting intermittent errors. You suspect the data being sent is the culprit, but you&rsquo;re flying blind. Wouldn&rsquo;t it be great if you could see exactly what&rsquo;s going over the wire?.
In this article, we will look at how to create structured log events for HTTP API request/response transactions in an ASP.NET Core Web API using the Serilog logger and the HTTP Logging Middleware provided by Microsoft." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ranbook.cloud/posts/serilog-http-payload-logging/" />
<meta property="og:image" content="https://ranbook.cloud/img/pexels-souvenirpixels-3985485.jpg" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2025-02-23T17:55:55-04:00" />
<meta property="article:modified_time" content="2025-02-23T17:55:55-04:00" /><meta property="og:site_name" content="Ranbook Cloud" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://ranbook.cloud/img/pexels-souvenirpixels-3985485.jpg" />
<meta name="twitter:title" content="ASP.NET Core WebAPI Payload Logging with Serilog"/>
<meta name="twitter:description" content="What Imagine debugging a tricky API integration where you&rsquo;re getting intermittent errors. You suspect the data being sent is the culprit, but you&rsquo;re flying blind. Wouldn&rsquo;t it be great if you could see exactly what&rsquo;s going over the wire?.
In this article, we will look at how to create structured log events for HTTP API request/response transactions in an ASP.NET Core Web API using the Serilog logger and the HTTP Logging Middleware provided by Microsoft."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://ranbook.cloud/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "ASP.NET Core WebAPI Payload Logging with Serilog",
      "item": "https://ranbook.cloud/posts/serilog-http-payload-logging/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "ASP.NET Core WebAPI Payload Logging with Serilog",
  "name": "ASP.NET Core WebAPI Payload Logging with Serilog",
  "description": "What Imagine debugging a tricky API integration where you\u0026rsquo;re getting intermittent errors. You suspect the data being sent is the culprit, but you\u0026rsquo;re flying blind. Wouldn\u0026rsquo;t it be great if you could see exactly what\u0026rsquo;s going over the wire?.\nIn this article, we will look at how to create structured log events for HTTP API request/response transactions in an ASP.NET Core Web API using the Serilog logger and the HTTP Logging Middleware provided by Microsoft.",
  "keywords": [
    "aspdotnetcore", ".net", "c#", "serilog", "http", "logging", "dotnet", "api", "microsoft"
  ],
  "articleBody": " What Imagine debugging a tricky API integration where you’re getting intermittent errors. You suspect the data being sent is the culprit, but you’re flying blind. Wouldn’t it be great if you could see exactly what’s going over the wire?.\nIn this article, we will look at how to create structured log events for HTTP API request/response transactions in an ASP.NET Core Web API using the Serilog logger and the HTTP Logging Middleware provided by Microsoft.\nGoal By the end of this article, you’ll be able to:\nHave well-structured log events containing the request/response payloads as distinct JSON objects (no complex regex required!). Avoid buffering payloads for non-JSON requests/responses to optimize performance.(specially for static content serving) Achieve all of this without writing custom middleware, leveraging Serilog’s power and flexibility. Why In addition to the reason mentioned in What section, for some API-based applications, logging the payload for a given API transaction is helpful from both audit and monitoring perspectives. While it’s generally not recommended to log the request or response body due to performance/compliance/security considerations, if there is a need for such a requirement and you understand all the risks, then hopefully this guide provides one of the many ways to achieve it.\nTools Used Serilog: We will configure Serilog \u0026 Serilog.Formatting.Compact to send logs in JSON format. Microsoft HTTP Logging Middleware: We will enable this middleware to it can capture the Request \u0026 Response payload without us writing custom middleware code to do it. Serilog.Expressions: We will use this to conditionally route log events between different logger contexts. Steps Create New WebAPI Project Lets create new Dotnet API Project with following CLI command\nmkdir serilog-payload-demo cd serilog-payload-demo dotnet new webapi Add Dependencies Lets add dependencies we will be using.\ndotnet add package Serilog dotnet add package Serilog.AspNetCore dotnet add package Serilog.Settings.Configuration dotnet add package Serilog.Sinks.Console dotnet add package Serilog.Enrichers.Process dotnet add package Serilog.Enrichers.Thread dotnet add package Serilog.Expressions dotnet add package Serilog.Formatting.Compact Load Serilog Configuration from appsettings Lets create SerilogConfiguration class which loads the Serilog configuration from appsettings.json files. Content for SerilogConfiguration.cs\nusing Serilog; namespace serilog_payload_demo.Configuration; public static class SerilogConfiguration { public static ILoggingBuilder AddCustomSerilogConfiguration(this ILoggingBuilder builder, IConfiguration configuration) { var loggerConfiguration = new LoggerConfiguration() .Enrich.FromLogContext() .ReadFrom.Configuration(configuration); Log.Logger = loggerConfiguration.CreateLogger(); return builder.AddSerilog(Log.Logger); } } Custom HTTP Interceptor We will create custom Interceptor to enable request \u0026 response payload log buffer when content type of the payload includes json so this way we are not buffering payloads for all the requests which doesn’t need payload logging(static content etc.,).\nYou can also further customize this interceptor for following.\nFilter to specific requests matching based on URL patterns or based specific HTTP Response return code range etc., Also create custom log fields containing masked sensitive data etc., Find more things at IHttpLoggingInterceptor documentation. Content for CustomHttpLoggingInterceptor.cs using Microsoft.AspNetCore.HttpLogging; namespace serilog_payload_demo.Configuration; internal sealed class CustomHttpLoggingInterceptor: IHttpLoggingInterceptor { public ValueTask OnRequestAsync(HttpLoggingInterceptorContext logContext) { if (logContext.HttpContext.Request.ContentType != null \u0026\u0026 logContext.HttpContext.Request.ContentType.Contains(\"json\")) { logContext.LoggingFields = HttpLoggingFields.RequestBody | HttpLoggingFields.RequestHeaders | HttpLoggingFields.RequestProtocol | HttpLoggingFields.RequestQuery; } else { logContext.LoggingFields = HttpLoggingFields.None; } return default; } public ValueTask OnResponseAsync(HttpLoggingInterceptorContext logContext) { if (logContext.HttpContext.Response.ContentType != null \u0026\u0026 logContext.HttpContext.Response.ContentType.Contains(\"json\")) { logContext.LoggingFields = HttpLoggingFields.RequestBody | HttpLoggingFields.RequestHeaders | HttpLoggingFields.RequestProtocol | HttpLoggingFields.RequestQuery | HttpLoggingFields.ResponseBody | HttpLoggingFields.ResponseHeaders | HttpLoggingFields.Duration | HttpLoggingFields.ResponseStatusCode; } return default; } } Capturing Payload Events Now for the tricky part, since we let HttpLoggingMiddleware capture payloads with above interceptor, let’s get these log events routed through custom Serilog Formatter to properly parse JSON payloads and create a useful JSON log event.\nNote: This formatter is heavily inspired from CompactJsonFormatter Content for PayloadLogFormatter.cs.\nusing System.Globalization; using Newtonsoft.Json; using Serilog.Events; using Serilog.Formatting; using Serilog.Formatting.Json; using Serilog.Parsing; namespace serilog_payload_demo.Configuration; public class PayloadLogFormatter : ITextFormatter { readonly JsonValueFormatter _valueFormatter; public PayloadLogFormatter(JsonValueFormatter? valueFormatter = null) { _valueFormatter = valueFormatter ?? new JsonValueFormatter(typeTagName: \"$type\"); } public void Format(LogEvent logEvent, TextWriter output) { FormatEvent(logEvent, output, _valueFormatter); output.WriteLine(); } public static void FormatEvent(LogEvent logEvent, TextWriter output, JsonValueFormatter valueFormatter) { if (logEvent == null) throw new ArgumentNullException(nameof(logEvent)); if (output == null) throw new ArgumentNullException(nameof(output)); if (valueFormatter == null) throw new ArgumentNullException(nameof(valueFormatter)); output.Write(\"{\\\"@t\\\":\\\"\"); output.Write(logEvent.Timestamp.UtcDateTime.ToString(\"O\")); output.Write(\"\\\",\\\"@m\\\":\\\"PayloadEvent\\\"\"); output.Write(\",\\\"@l\\\":\\\"\"); output.Write(logEvent.Level); output.Write('\\\"'); if (logEvent.TraceId != null) { output.Write(\",\\\"@tr\\\":\\\"\"); output.Write(logEvent.TraceId.Value.ToHexString()); output.Write('\\\"'); } if (logEvent.SpanId != null) { output.Write(\",\\\"@sp\\\":\\\"\"); output.Write(logEvent.SpanId.Value.ToHexString()); output.Write('\\\"'); } foreach (var property in logEvent.Properties) { var name = property.Key; if (name.Length \u003e 0 \u0026\u0026 name[0] == '@') { // Escape first '@' by doubling name = '@' + name; } //TO-DO: We can write the code in programmatic way to allow which properties to be logged part of this event. switch (name) { case \"HttpLog\": break; case \"SourceContext\": output.Write(','); JsonValueFormatter.WriteQuotedJsonString(\"@sc\", output); output.Write(':'); valueFormatter.Format(property.Value, output); break; case \"Duration\": output.Write(','); JsonValueFormatter.WriteQuotedJsonString(\"duration\", output); output.Write(':'); valueFormatter.Format(property.Value, output); break; case \"StatusCode\": output.Write(','); JsonValueFormatter.WriteQuotedJsonString(\"statusCode\", output); output.Write(':'); valueFormatter.Format(property.Value, output); break; case \"ResponseBody\": output.Write(','); JsonValueFormatter.WriteQuotedJsonString(\"responseBody\", output); output.Write(':'); output.Write(JsonConvert.DeserializeObject(property.Value.ToString()).ToString().Replace(\"\\n\", \"\")); break; case \"RequestBody\": output.Write(','); JsonValueFormatter.WriteQuotedJsonString(\"requestBody\", output); output.Write(':'); output.Write(JsonConvert.DeserializeObject(property.Value.ToString()).ToString().Replace(\"\\n\", \"\")); break; case \"RequestPath\": output.Write(','); JsonValueFormatter.WriteQuotedJsonString(\"requestPath\", output); output.Write(':'); valueFormatter.Format(property.Value, output); break; case \"Method\": output.Write(','); JsonValueFormatter.WriteQuotedJsonString(\"requestMethod\", output); output.Write(':'); valueFormatter.Format(property.Value, output); break; default: output.Write(','); JsonValueFormatter.WriteQuotedJsonString(name, output); output.Write(':'); valueFormatter.Format(property.Value, output); break; } } output.Write('}'); } } AppSettings Serilog Configuration Lets add following Serilog section to appsettings-*.json so, we can conditionally route the log events to our formatter for Microsoft.AspNetCore.HttpLogging.HttpLoggingMiddleware events. Note: This conditional routing is achieved using Serilog.Expressions. Again, for the demo purpose, I have used Serilog Console Sink but you can change it to your preferred Sinks. Below is the appsettings-Development.json content.\n{ \"Serilog\": { \"MinimumLevel\": \"Information\", \"WriteTo\": [ { \"Name\": \"Conditional\", \"Args\": { \"expression\": \"SourceContext \u003c\u003e 'Microsoft.AspNetCore.HttpLogging.HttpLoggingMiddleware'\", \"configureSink\": { \"Console\": { \"Name\": \"Console\", \"Args\": { \"formatter\": \"Serilog.Formatting.Compact.CompactJsonFormatter, Serilog.Formatting.Compact\" } } } } }, { \"Name\": \"Conditional\", \"Args\": { \"expression\": \"SourceContext = 'Microsoft.AspNetCore.HttpLogging.HttpLoggingMiddleware'\", \"configureSink\": { \"Console\": { \"Name\": \"Console\", \"Args\": { \"formatter\": { \"type\": \"serilog_payload_demo.Configuration.PayloadLogFormatter, serilog-payload-demo\" } } } } } } ] }, \"Logging\": { \"LogLevel\": { \"Default\": \"Information\", \"Microsoft.AspNetCore\": \"Warning\" } } } Lets bring this together Lets enable Serilog and HTTP Middleware with custom interceptor in Program.cs or wherever applicable for your app before builder.Build(); line.\nusing Microsoft.AspNetCore.HttpLogging; using Serilog; using serilog_payload_demo.Configuration; using Microsoft.Extensions.Options; builder.Services.AddSerilog(); builder.Logging.AddCustomSerilogConfiguration(builder.Configuration); builder.Services.AddHttpLogging(o =\u003e { o.CombineLogs = true; }).AddHttpLoggingInterceptor(); Enable HTTPLogging for the app.\napp.UseHttpLogging(); Let’s look at the Results I have performed same changes in this demo app at https://github.com/imran9m/serilog-payload-demo) which you can checkout.\nOnce you run dotnet run and execute an API call at http://localhost:5077/weatherforecast/ then you should be able to see following logs produced in Console.\n{\"@t\":\"2025-02-23T04:31:38.3818101Z\",\"@mt\":\"Now listening on: {address}\",\"address\":\"http://localhost:5077\",\"EventId\":{\"Id\":14,\"Name\":\"ListeningOnAddress\"},\"SourceContext\":\"Microsoft.Hosting.Lifetime\"} {\"@t\":\"2025-02-23T04:31:38.3989156Z\",\"@mt\":\"Application started. Press Ctrl+C to shut down.\",\"SourceContext\":\"Microsoft.Hosting.Lifetime\"} {\"@t\":\"2025-02-23T04:31:38.3992277Z\",\"@mt\":\"Hosting environment: {EnvName}\",\"EnvName\":\"Development\",\"SourceContext\":\"Microsoft.Hosting.Lifetime\"} For API execution, you should also see a log event for Payload in this format.\n{ \"@t\": \"2025-02-23T04:31:47.2198850Z\", \"@m\": \"PayloadEvent\", \"@l\": \"Information\", \"@tr\": \"b5fa803d71687958c047a05acffd013c\", \"@sp\": \"e8b0c58db6c9835e\", \"statusCode\": 200, \"Content-Type\": \"application/json; charset=utf-8\", \"responseBody\": [ { \"date\": \"2025-02-23\", \"temperatureC\": 4, \"summary\": \"Chilly\", \"temperatureF\": 39 }, { \"date\": \"2025-02-24\", \"temperatureC\": -9, \"summary\": \"Bracing\", \"temperatureF\": 16 }, { \"date\": \"2025-02-25\", \"temperatureC\": 45, \"summary\": \"Hot\", \"temperatureF\": 112 }, { \"date\": \"2025-02-26\", \"temperatureC\": -3, \"summary\": \"Balmy\", \"temperatureF\": 27 }, { \"date\": \"2025-02-27\", \"temperatureC\": 38, \"summary\": \"Hot\", \"temperatureF\": 100 } ], \"duration\": 11.5259, \"EventId\": { \"Id\": 9, \"Name\": \"RequestResponseLog\" }, \"@sc\": \"Microsoft.AspNetCore.HttpLogging.HttpLoggingMiddleware\", \"RequestId\": \"0HNAJOBTUGLRV:00000001\", \"requestPath\": \"/weatherforecast/\", \"ConnectionId\": \"0HNAJOBTUGLRV\" } That’s it. This is one of the ways to achieve payload logging in ASP.NETCore Web APIs. Keep in mind, this code was not tested for performance benchmarks so use it with caution.\nIf you have any feedback/issues, you can submit an issue in site repo.\n",
  "wordCount" : "1206",
  "inLanguage": "en",
  "image":"https://ranbook.cloud/img/pexels-souvenirpixels-3985485.jpg","datePublished": "2025-02-23T17:55:55-04:00",
  "dateModified": "2025-02-23T17:55:55-04:00",
  "author":{
    "@type": "Person",
    "name": "Imran"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://ranbook.cloud/posts/serilog-http-payload-logging/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Ranbook Cloud",
    "logo": {
      "@type": "ImageObject",
      "url": "https://ranbook.cloud/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://ranbook.cloud/" accesskey="h" title="Ranbook Cloud (Alt + H)">Ranbook Cloud</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://ranbook.cloud/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="https://ranbook.cloud/posts" title="Posts">
                    <span>Posts</span>
                </a>
            </li>
            <li>
                <a href="https://ranbook.cloud/answers" title="StackOverflow">
                    <span>StackOverflow</span>
                </a>
            </li>
            <li>
                <a href="https://ranbook.cloud/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://ranbook.cloud/">Home</a>&nbsp;»&nbsp;<a href="https://ranbook.cloud/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      ASP.NET Core WebAPI Payload Logging with Serilog
    </h1>
    <div class="post-meta"><span title='2025-02-23 17:55:55 -0400 -0400'>February 23, 2025</span>&nbsp;·&nbsp;6 min&nbsp;·&nbsp;Imran

</div>
  </header> 
<figure class="entry-cover"><a href="https://ranbook.cloud/img/pexels-souvenirpixels-3985485.jpg" target="_blank"
            rel="noopener noreferrer"><img loading="eager" src="https://ranbook.cloud/img/pexels-souvenirpixels-3985485.jpg" alt=""></a>
        
</figure><div class="toc">
    <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#inswhatins" aria-label="What">What</a></li>
                <li>
                    <a href="#goal" aria-label="Goal">Goal</a></li>
                <li>
                    <a href="#why" aria-label="Why">Why</a></li>
                <li>
                    <a href="#tools-used" aria-label="Tools Used">Tools Used</a></li>
                <li>
                    <a href="#steps" aria-label="Steps">Steps</a><ul>
                        
                <li>
                    <a href="#create-new-webapi-project" aria-label="Create New WebAPI Project">Create New WebAPI Project</a></li>
                <li>
                    <a href="#add-dependencies" aria-label="Add Dependencies">Add Dependencies</a></li>
                <li>
                    <a href="#load-serilog-configuration-from-appsettings" aria-label="Load Serilog Configuration from appsettings">Load Serilog Configuration from appsettings</a></li>
                <li>
                    <a href="#custom-http-interceptor" aria-label="Custom HTTP Interceptor">Custom HTTP Interceptor</a></li>
                <li>
                    <a href="#capturing-payload-events" aria-label="Capturing Payload Events">Capturing Payload Events</a></li>
                <li>
                    <a href="#appsettings-serilog-configuration" aria-label="AppSettings Serilog Configuration">AppSettings Serilog Configuration</a></li>
                <li>
                    <a href="#lets-bring-this-together" aria-label="Lets bring this together">Lets bring this together</a></li></ul>
                </li>
                <li>
                    <a href="#lets-look-at-the-results" aria-label="Let&rsquo;s look at the Results">Let&rsquo;s look at the Results</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><hr>
<h2 id="inswhatins"><!-- raw HTML omitted -->What<!-- raw HTML omitted --><a hidden class="anchor" aria-hidden="true" href="#inswhatins">#</a></h2>
<p>Imagine debugging a tricky API integration where you&rsquo;re getting intermittent errors. You suspect the data being sent is the culprit, but you&rsquo;re flying blind. Wouldn&rsquo;t it be great if you could see exactly what&rsquo;s going over the wire?.</p>
<p>In this article, we will look at how to create structured log events for HTTP API request/response transactions in an ASP.NET Core Web API using the <code>Serilog</code> logger and the <code>HTTP Logging</code> Middleware provided by Microsoft.</p>
<h2 id="goal">Goal<a hidden class="anchor" aria-hidden="true" href="#goal">#</a></h2>
<p>By the end of this article, you&rsquo;ll be able to:</p>
<ul>
<li>Have well-structured log events containing the request/response payloads as distinct JSON objects (no complex regex required!).</li>
<li>Avoid buffering payloads for non-JSON requests/responses to optimize performance.(specially for static content serving)</li>
<li>Achieve all of this without writing custom middleware, leveraging Serilog&rsquo;s power and flexibility.</li>
</ul>
<h2 id="why">Why<a hidden class="anchor" aria-hidden="true" href="#why">#</a></h2>
<p>In addition to the reason mentioned in <em><strong>What</strong></em> section, for some API-based applications, logging the payload for a given API transaction is helpful from both audit and monitoring perspectives. While it&rsquo;s generally not recommended to log the request or response body due to performance/compliance/security considerations, if there is a need for such a requirement and you understand all the risks, then hopefully this guide provides one of the many ways to achieve it.</p>
<h2 id="tools-used">Tools Used<a hidden class="anchor" aria-hidden="true" href="#tools-used">#</a></h2>
<ul>
<li><strong>Serilog</strong>: We will configure Serilog &amp; <a href="https://github.com/serilog/serilog-formatting-compact">Serilog.Formatting.Compact</a> to send logs in JSON format.</li>
<li><strong>Microsoft HTTP Logging Middleware</strong>: We will enable this <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/http-logging/?view=aspnetcore-9.0">middleware</a> to it can capture the Request &amp; Response payload without us writing custom middleware code to do it.</li>
<li><strong>Serilog.Expressions</strong>: We will use this to conditionally route log events between different logger contexts.</li>
</ul>
<hr>
<h2 id="steps">Steps<a hidden class="anchor" aria-hidden="true" href="#steps">#</a></h2>
<ol>
<li>
<h3 id="create-new-webapi-project">Create New WebAPI Project<a hidden class="anchor" aria-hidden="true" href="#create-new-webapi-project">#</a></h3>
<p>Lets create new Dotnet API Project with following CLI command</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir serilog-payload-demo
</span></span><span style="display:flex;"><span>cd serilog-payload-demo
</span></span><span style="display:flex;"><span>dotnet new webapi
</span></span></code></pre></div><h3 id="add-dependencies">Add Dependencies<a hidden class="anchor" aria-hidden="true" href="#add-dependencies">#</a></h3>
<p>Lets add dependencies we will be using.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>dotnet add package Serilog
</span></span><span style="display:flex;"><span>dotnet add package Serilog.AspNetCore
</span></span><span style="display:flex;"><span>dotnet add package Serilog.Settings.Configuration
</span></span><span style="display:flex;"><span>dotnet add package Serilog.Sinks.Console
</span></span><span style="display:flex;"><span>dotnet add package Serilog.Enrichers.Process
</span></span><span style="display:flex;"><span>dotnet add package Serilog.Enrichers.Thread
</span></span><span style="display:flex;"><span>dotnet add package Serilog.Expressions
</span></span><span style="display:flex;"><span>dotnet add package Serilog.Formatting.Compact
</span></span></code></pre></div></li>
<li>
<h3 id="load-serilog-configuration-from-appsettings">Load Serilog Configuration from appsettings<a hidden class="anchor" aria-hidden="true" href="#load-serilog-configuration-from-appsettings">#</a></h3>
<p>Lets create <code>SerilogConfiguration</code> class which loads the Serilog configuration from <code>appsettings.json</code> files.
<br>
<br>
<em>Content for <code>SerilogConfiguration.cs</code></em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Serilog;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> serilog_payload_demo.Configuration;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SerilogConfiguration</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> ILoggingBuilder AddCustomSerilogConfiguration(<span style="color:#66d9ef">this</span> ILoggingBuilder builder, IConfiguration configuration)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">var</span> loggerConfiguration = <span style="color:#66d9ef">new</span> LoggerConfiguration()
</span></span><span style="display:flex;"><span>            .Enrich.FromLogContext()
</span></span><span style="display:flex;"><span>            .ReadFrom.Configuration(configuration);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Log.Logger = loggerConfiguration.CreateLogger();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> builder.AddSerilog(Log.Logger);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></li>
<li>
<h3 id="custom-http-interceptor">Custom HTTP Interceptor<a hidden class="anchor" aria-hidden="true" href="#custom-http-interceptor">#</a></h3>
<p>We will create custom <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/http-logging/?view=aspnetcore-9.0#ihttplogginginterceptor">Interceptor</a> to enable request &amp; response payload log buffer when content type of the payload includes json so this way we are not buffering payloads for all the requests which doesn&rsquo;t need payload logging(static content etc.,).<br>
<br>
You can also further customize this interceptor for following.</p>
<ul>
<li>Filter to specific requests matching based on URL patterns or based specific HTTP Response return code range etc.,</li>
<li>Also create custom log fields containing masked sensitive data etc.,</li>
<li>Find more things at <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/http-logging/?view=aspnetcore-9.0#ihttplogginginterceptor">IHttpLoggingInterceptor</a> documentation.
<br>
<br>
<em>Content for <code>CustomHttpLoggingInterceptor.cs</code></em></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Microsoft.AspNetCore.HttpLogging;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> serilog_payload_demo.Configuration;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CustomHttpLoggingInterceptor</span>: IHttpLoggingInterceptor
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> ValueTask OnRequestAsync(HttpLoggingInterceptorContext logContext)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (logContext.HttpContext.Request.ContentType != <span style="color:#66d9ef">null</span> &amp;&amp; logContext.HttpContext.Request.ContentType.Contains(<span style="color:#e6db74">&#34;json&#34;</span>))
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            logContext.LoggingFields = HttpLoggingFields.RequestBody
</span></span><span style="display:flex;"><span>                | HttpLoggingFields.RequestHeaders
</span></span><span style="display:flex;"><span>                | HttpLoggingFields.RequestProtocol
</span></span><span style="display:flex;"><span>                | HttpLoggingFields.RequestQuery;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            logContext.LoggingFields = HttpLoggingFields.None;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">default</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> ValueTask OnResponseAsync(HttpLoggingInterceptorContext logContext)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (logContext.HttpContext.Response.ContentType != <span style="color:#66d9ef">null</span> &amp;&amp; logContext.HttpContext.Response.ContentType.Contains(<span style="color:#e6db74">&#34;json&#34;</span>))
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            logContext.LoggingFields = HttpLoggingFields.RequestBody
</span></span><span style="display:flex;"><span>                                    | HttpLoggingFields.RequestHeaders
</span></span><span style="display:flex;"><span>                                    | HttpLoggingFields.RequestProtocol
</span></span><span style="display:flex;"><span>                                    | HttpLoggingFields.RequestQuery
</span></span><span style="display:flex;"><span>                                    | HttpLoggingFields.ResponseBody
</span></span><span style="display:flex;"><span>                                    | HttpLoggingFields.ResponseHeaders
</span></span><span style="display:flex;"><span>                                    | HttpLoggingFields.Duration
</span></span><span style="display:flex;"><span>                                    | HttpLoggingFields.ResponseStatusCode;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">default</span>;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></li>
<li>
<h3 id="capturing-payload-events">Capturing Payload Events<a hidden class="anchor" aria-hidden="true" href="#capturing-payload-events">#</a></h3>
<p>Now for the tricky part, since we let <code>HttpLoggingMiddleware</code> capture payloads with above interceptor, let&rsquo;s get these log events routed through custom Serilog Formatter to properly parse JSON payloads and create a useful JSON log event.<br>
<br>
<strong>Note</strong>: This formatter is heavily inspired from <a href="https://github.com/serilog/serilog-formatting-compact/blob/dev/src/Serilog.Formatting.Compact/CompactJsonFormatter.cs">CompactJsonFormatter</a>
<br>
<em>Content for <code>PayloadLogFormatter.cs</code>.</em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> System.Globalization;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Newtonsoft.Json;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Serilog.Events;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Serilog.Formatting;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Serilog.Formatting.Json;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Serilog.Parsing;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> serilog_payload_demo.Configuration;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PayloadLogFormatter</span> : ITextFormatter
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">readonly</span> JsonValueFormatter _valueFormatter;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> PayloadLogFormatter(JsonValueFormatter? valueFormatter = <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        _valueFormatter = valueFormatter ?? <span style="color:#66d9ef">new</span> JsonValueFormatter(typeTagName: <span style="color:#e6db74">&#34;$type&#34;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> Format(LogEvent logEvent, TextWriter output)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        FormatEvent(logEvent, output, _valueFormatter);
</span></span><span style="display:flex;"><span>        output.WriteLine();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">void</span> FormatEvent(LogEvent logEvent, TextWriter output, JsonValueFormatter valueFormatter)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (logEvent == <span style="color:#66d9ef">null</span>) <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> ArgumentNullException(nameof(logEvent));
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (output == <span style="color:#66d9ef">null</span>) <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> ArgumentNullException(nameof(output));
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (valueFormatter == <span style="color:#66d9ef">null</span>) <span style="color:#66d9ef">throw</span> <span style="color:#66d9ef">new</span> ArgumentNullException(nameof(valueFormatter));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        output.Write(<span style="color:#e6db74">&#34;{\&#34;@t\&#34;:\&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>        output.Write(logEvent.Timestamp.UtcDateTime.ToString(<span style="color:#e6db74">&#34;O&#34;</span>));
</span></span><span style="display:flex;"><span>        output.Write(<span style="color:#e6db74">&#34;\&#34;,\&#34;@m\&#34;:\&#34;PayloadEvent\&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        output.Write(<span style="color:#e6db74">&#34;,\&#34;@l\&#34;:\&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>        output.Write(logEvent.Level);
</span></span><span style="display:flex;"><span>        output.Write(<span style="color:#e6db74">&#39;\&#34;&#39;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (logEvent.TraceId != <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            output.Write(<span style="color:#e6db74">&#34;,\&#34;@tr\&#34;:\&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>            output.Write(logEvent.TraceId.Value.ToHexString());
</span></span><span style="display:flex;"><span>            output.Write(<span style="color:#e6db74">&#39;\&#34;&#39;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> (logEvent.SpanId != <span style="color:#66d9ef">null</span>)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            output.Write(<span style="color:#e6db74">&#34;,\&#34;@sp\&#34;:\&#34;&#34;</span>);
</span></span><span style="display:flex;"><span>            output.Write(logEvent.SpanId.Value.ToHexString());
</span></span><span style="display:flex;"><span>            output.Write(<span style="color:#e6db74">&#39;\&#34;&#39;</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">foreach</span> (<span style="color:#66d9ef">var</span> property <span style="color:#66d9ef">in</span> logEvent.Properties)
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">var</span> name = property.Key;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> (name.Length &gt; <span style="color:#ae81ff">0</span> &amp;&amp; name[<span style="color:#ae81ff">0</span>] == <span style="color:#e6db74">&#39;@&#39;</span>)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">// Escape first &#39;@&#39; by doubling</span>
</span></span><span style="display:flex;"><span>                name = <span style="color:#e6db74">&#39;@&#39;</span> + name;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">//TO-DO: We can write the code in programmatic way to allow which properties to be logged part of this event.</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">switch</span> (name)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;HttpLog&#34;</span>:
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;SourceContext&#34;</span>:
</span></span><span style="display:flex;"><span>                    output.Write(<span style="color:#e6db74">&#39;,&#39;</span>);
</span></span><span style="display:flex;"><span>                    JsonValueFormatter.WriteQuotedJsonString(<span style="color:#e6db74">&#34;@sc&#34;</span>, output);
</span></span><span style="display:flex;"><span>                    output.Write(<span style="color:#e6db74">&#39;:&#39;</span>);
</span></span><span style="display:flex;"><span>                    valueFormatter.Format(property.Value, output);
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;Duration&#34;</span>:
</span></span><span style="display:flex;"><span>                    output.Write(<span style="color:#e6db74">&#39;,&#39;</span>);
</span></span><span style="display:flex;"><span>                    JsonValueFormatter.WriteQuotedJsonString(<span style="color:#e6db74">&#34;duration&#34;</span>, output);
</span></span><span style="display:flex;"><span>                    output.Write(<span style="color:#e6db74">&#39;:&#39;</span>);
</span></span><span style="display:flex;"><span>                    valueFormatter.Format(property.Value, output);
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;StatusCode&#34;</span>:
</span></span><span style="display:flex;"><span>                    output.Write(<span style="color:#e6db74">&#39;,&#39;</span>);
</span></span><span style="display:flex;"><span>                    JsonValueFormatter.WriteQuotedJsonString(<span style="color:#e6db74">&#34;statusCode&#34;</span>, output);
</span></span><span style="display:flex;"><span>                    output.Write(<span style="color:#e6db74">&#39;:&#39;</span>);
</span></span><span style="display:flex;"><span>                    valueFormatter.Format(property.Value, output);
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;ResponseBody&#34;</span>:
</span></span><span style="display:flex;"><span>                    output.Write(<span style="color:#e6db74">&#39;,&#39;</span>);
</span></span><span style="display:flex;"><span>                    JsonValueFormatter.WriteQuotedJsonString(<span style="color:#e6db74">&#34;responseBody&#34;</span>, output);
</span></span><span style="display:flex;"><span>                    output.Write(<span style="color:#e6db74">&#39;:&#39;</span>);
</span></span><span style="display:flex;"><span>                    output.Write(JsonConvert.DeserializeObject(property.Value.ToString()).ToString().Replace(<span style="color:#e6db74">&#34;\n&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>));
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;RequestBody&#34;</span>:
</span></span><span style="display:flex;"><span>                    output.Write(<span style="color:#e6db74">&#39;,&#39;</span>);
</span></span><span style="display:flex;"><span>                    JsonValueFormatter.WriteQuotedJsonString(<span style="color:#e6db74">&#34;requestBody&#34;</span>, output);
</span></span><span style="display:flex;"><span>                    output.Write(<span style="color:#e6db74">&#39;:&#39;</span>);
</span></span><span style="display:flex;"><span>                    output.Write(JsonConvert.DeserializeObject(property.Value.ToString()).ToString().Replace(<span style="color:#e6db74">&#34;\n&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>));
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;RequestPath&#34;</span>:
</span></span><span style="display:flex;"><span>                    output.Write(<span style="color:#e6db74">&#39;,&#39;</span>);
</span></span><span style="display:flex;"><span>                    JsonValueFormatter.WriteQuotedJsonString(<span style="color:#e6db74">&#34;requestPath&#34;</span>, output);
</span></span><span style="display:flex;"><span>                    output.Write(<span style="color:#e6db74">&#39;:&#39;</span>);
</span></span><span style="display:flex;"><span>                    valueFormatter.Format(property.Value, output);
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#34;Method&#34;</span>:
</span></span><span style="display:flex;"><span>                    output.Write(<span style="color:#e6db74">&#39;,&#39;</span>);
</span></span><span style="display:flex;"><span>                    JsonValueFormatter.WriteQuotedJsonString(<span style="color:#e6db74">&#34;requestMethod&#34;</span>, output);
</span></span><span style="display:flex;"><span>                    output.Write(<span style="color:#e6db74">&#39;:&#39;</span>);
</span></span><span style="display:flex;"><span>                    valueFormatter.Format(property.Value, output);
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">default</span>:
</span></span><span style="display:flex;"><span>                    output.Write(<span style="color:#e6db74">&#39;,&#39;</span>);
</span></span><span style="display:flex;"><span>                    JsonValueFormatter.WriteQuotedJsonString(name, output);
</span></span><span style="display:flex;"><span>                    output.Write(<span style="color:#e6db74">&#39;:&#39;</span>);
</span></span><span style="display:flex;"><span>                    valueFormatter.Format(property.Value, output);
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        output.Write(<span style="color:#e6db74">&#39;}&#39;</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></li>
<li>
<h3 id="appsettings-serilog-configuration">AppSettings Serilog Configuration<a hidden class="anchor" aria-hidden="true" href="#appsettings-serilog-configuration">#</a></h3>
<p>Lets add following <code>Serilog</code> section to <code>appsettings-*.json</code> so, we can conditionally route the log events to our formatter for <code>Microsoft.AspNetCore.HttpLogging.HttpLoggingMiddleware</code> events.
<br>
<strong>Note</strong>: This conditional routing is achieved using <code>Serilog.Expressions</code>. Again, for the demo purpose, I have used Serilog Console Sink but you can change it to your preferred Sinks.
<br>
<em>Below is the <code>appsettings-Development.json</code> content.</em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Serilog&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;MinimumLevel&#34;</span>: <span style="color:#e6db74">&#34;Information&#34;</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;WriteTo&#34;</span>: [
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;Name&#34;</span>: <span style="color:#e6db74">&#34;Conditional&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;Args&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;expression&#34;</span>: <span style="color:#e6db74">&#34;SourceContext &lt;&gt; &#39;Microsoft.AspNetCore.HttpLogging.HttpLoggingMiddleware&#39;&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;configureSink&#34;</span>: {
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;Console&#34;</span>: {
</span></span><span style="display:flex;"><span>                            <span style="color:#f92672">&#34;Name&#34;</span>: <span style="color:#e6db74">&#34;Console&#34;</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#f92672">&#34;Args&#34;</span>: {
</span></span><span style="display:flex;"><span>                                <span style="color:#f92672">&#34;formatter&#34;</span>: <span style="color:#e6db74">&#34;Serilog.Formatting.Compact.CompactJsonFormatter, Serilog.Formatting.Compact&#34;</span>
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>                        }
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            },
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;Name&#34;</span>: <span style="color:#e6db74">&#34;Conditional&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">&#34;Args&#34;</span>: {
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;expression&#34;</span>: <span style="color:#e6db74">&#34;SourceContext = &#39;Microsoft.AspNetCore.HttpLogging.HttpLoggingMiddleware&#39;&#34;</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#f92672">&#34;configureSink&#34;</span>: {
</span></span><span style="display:flex;"><span>                        <span style="color:#f92672">&#34;Console&#34;</span>: {
</span></span><span style="display:flex;"><span>                            <span style="color:#f92672">&#34;Name&#34;</span>: <span style="color:#e6db74">&#34;Console&#34;</span>,
</span></span><span style="display:flex;"><span>                            <span style="color:#f92672">&#34;Args&#34;</span>: {
</span></span><span style="display:flex;"><span>                                <span style="color:#f92672">&#34;formatter&#34;</span>: {
</span></span><span style="display:flex;"><span>                                    <span style="color:#f92672">&#34;type&#34;</span>: <span style="color:#e6db74">&#34;serilog_payload_demo.Configuration.PayloadLogFormatter, serilog-payload-demo&#34;</span>
</span></span><span style="display:flex;"><span>                                }
</span></span><span style="display:flex;"><span>                            }
</span></span><span style="display:flex;"><span>                        }
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        ]
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Logging&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;LogLevel&#34;</span>: {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;Default&#34;</span>: <span style="color:#e6db74">&#34;Information&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;Microsoft.AspNetCore&#34;</span>: <span style="color:#e6db74">&#34;Warning&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></li>
<li>
<h3 id="lets-bring-this-together">Lets bring this together<a hidden class="anchor" aria-hidden="true" href="#lets-bring-this-together">#</a></h3>
<p>Lets enable Serilog and HTTP Middleware with custom interceptor in <code>Program.cs</code> or wherever applicable for your app before <code>builder.Build();</code> line.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Microsoft.AspNetCore.HttpLogging;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Serilog;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> serilog_payload_demo.Configuration;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Microsoft.Extensions.Options;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>builder.Services.AddSerilog();
</span></span><span style="display:flex;"><span>builder.Logging.AddCustomSerilogConfiguration(builder.Configuration);
</span></span><span style="display:flex;"><span>builder.Services.AddHttpLogging(o =&gt;
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    o.CombineLogs = <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>}).AddHttpLoggingInterceptor&lt;CustomHttpLoggingInterceptor&gt;();
</span></span></code></pre></div><p>Enable HTTPLogging for the app.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-csharp" data-lang="csharp"><span style="display:flex;"><span>app.UseHttpLogging();
</span></span></code></pre></div></li>
</ol>
<hr>
<h2 id="lets-look-at-the-results">Let&rsquo;s look at the Results<a hidden class="anchor" aria-hidden="true" href="#lets-look-at-the-results">#</a></h2>
<p>I have performed same changes in this demo app at <a href="https://github.com/imran9m/serilog-payload-demo">https://github.com/imran9m/serilog-payload-demo</a>) which you can checkout.</p>
<p>Once you run <code>dotnet run</code> and execute an API call at <code>http://localhost:5077/weatherforecast/</code> then you should be able to see following logs produced in Console.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{<span style="color:#f92672">&#34;@t&#34;</span>:<span style="color:#e6db74">&#34;2025-02-23T04:31:38.3818101Z&#34;</span>,<span style="color:#f92672">&#34;@mt&#34;</span>:<span style="color:#e6db74">&#34;Now listening on: {address}&#34;</span>,<span style="color:#f92672">&#34;address&#34;</span>:<span style="color:#e6db74">&#34;http://localhost:5077&#34;</span>,<span style="color:#f92672">&#34;EventId&#34;</span>:{<span style="color:#f92672">&#34;Id&#34;</span>:<span style="color:#ae81ff">14</span>,<span style="color:#f92672">&#34;Name&#34;</span>:<span style="color:#e6db74">&#34;ListeningOnAddress&#34;</span>},<span style="color:#f92672">&#34;SourceContext&#34;</span>:<span style="color:#e6db74">&#34;Microsoft.Hosting.Lifetime&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="color:#f92672">&#34;@t&#34;</span>:<span style="color:#e6db74">&#34;2025-02-23T04:31:38.3989156Z&#34;</span>,<span style="color:#f92672">&#34;@mt&#34;</span>:<span style="color:#e6db74">&#34;Application started. Press Ctrl+C to shut down.&#34;</span>,<span style="color:#f92672">&#34;SourceContext&#34;</span>:<span style="color:#e6db74">&#34;Microsoft.Hosting.Lifetime&#34;</span>}
</span></span><span style="display:flex;"><span>{<span style="color:#f92672">&#34;@t&#34;</span>:<span style="color:#e6db74">&#34;2025-02-23T04:31:38.3992277Z&#34;</span>,<span style="color:#f92672">&#34;@mt&#34;</span>:<span style="color:#e6db74">&#34;Hosting environment: {EnvName}&#34;</span>,<span style="color:#f92672">&#34;EnvName&#34;</span>:<span style="color:#e6db74">&#34;Development&#34;</span>,<span style="color:#f92672">&#34;SourceContext&#34;</span>:<span style="color:#e6db74">&#34;Microsoft.Hosting.Lifetime&#34;</span>}
</span></span></code></pre></div><p>For API execution, you should also see a log event for Payload in this format.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;@t&#34;</span>: <span style="color:#e6db74">&#34;2025-02-23T04:31:47.2198850Z&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;@m&#34;</span>: <span style="color:#e6db74">&#34;PayloadEvent&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;@l&#34;</span>: <span style="color:#e6db74">&#34;Information&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;@tr&#34;</span>: <span style="color:#e6db74">&#34;b5fa803d71687958c047a05acffd013c&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;@sp&#34;</span>: <span style="color:#e6db74">&#34;e8b0c58db6c9835e&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;statusCode&#34;</span>: <span style="color:#ae81ff">200</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;Content-Type&#34;</span>: <span style="color:#e6db74">&#34;application/json; charset=utf-8&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;responseBody&#34;</span>: [
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;date&#34;</span>: <span style="color:#e6db74">&#34;2025-02-23&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;temperatureC&#34;</span>: <span style="color:#ae81ff">4</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;summary&#34;</span>: <span style="color:#e6db74">&#34;Chilly&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;temperatureF&#34;</span>: <span style="color:#ae81ff">39</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;date&#34;</span>: <span style="color:#e6db74">&#34;2025-02-24&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;temperatureC&#34;</span>: <span style="color:#ae81ff">-9</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;summary&#34;</span>: <span style="color:#e6db74">&#34;Bracing&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;temperatureF&#34;</span>: <span style="color:#ae81ff">16</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;date&#34;</span>: <span style="color:#e6db74">&#34;2025-02-25&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;temperatureC&#34;</span>: <span style="color:#ae81ff">45</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;summary&#34;</span>: <span style="color:#e6db74">&#34;Hot&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;temperatureF&#34;</span>: <span style="color:#ae81ff">112</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;date&#34;</span>: <span style="color:#e6db74">&#34;2025-02-26&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;temperatureC&#34;</span>: <span style="color:#ae81ff">-3</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;summary&#34;</span>: <span style="color:#e6db74">&#34;Balmy&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;temperatureF&#34;</span>: <span style="color:#ae81ff">27</span>
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;date&#34;</span>: <span style="color:#e6db74">&#34;2025-02-27&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;temperatureC&#34;</span>: <span style="color:#ae81ff">38</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;summary&#34;</span>: <span style="color:#e6db74">&#34;Hot&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">&#34;temperatureF&#34;</span>: <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    ],
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;duration&#34;</span>: <span style="color:#ae81ff">11.5259</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;EventId&#34;</span>: {
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;Id&#34;</span>: <span style="color:#ae81ff">9</span>,
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#34;Name&#34;</span>: <span style="color:#e6db74">&#34;RequestResponseLog&#34;</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;@sc&#34;</span>: <span style="color:#e6db74">&#34;Microsoft.AspNetCore.HttpLogging.HttpLoggingMiddleware&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;RequestId&#34;</span>: <span style="color:#e6db74">&#34;0HNAJOBTUGLRV:00000001&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;requestPath&#34;</span>: <span style="color:#e6db74">&#34;/weatherforecast/&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;ConnectionId&#34;</span>: <span style="color:#e6db74">&#34;0HNAJOBTUGLRV&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><blockquote>
<p>That&rsquo;s it. This is one of the ways to achieve payload logging in ASP.NETCore Web APIs. Keep in mind, this code was not tested for performance benchmarks so use it with caution.</p>
</blockquote>
<hr>
<p>If you have any feedback/issues, you can submit an issue in <a href="https://github.com/imran9m/ranbook.github.io">site repo</a>.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://ranbook.cloud/tags/aspdotnetcore/">Aspdotnetcore</a></li>
      <li><a href="https://ranbook.cloud/tags/.net/">.Net</a></li>
      <li><a href="https://ranbook.cloud/tags/c%23/">C#</a></li>
      <li><a href="https://ranbook.cloud/tags/serilog/">Serilog</a></li>
      <li><a href="https://ranbook.cloud/tags/http/">Http</a></li>
      <li><a href="https://ranbook.cloud/tags/logging/">Logging</a></li>
      <li><a href="https://ranbook.cloud/tags/dotnet/">Dotnet</a></li>
      <li><a href="https://ranbook.cloud/tags/api/">Api</a></li>
      <li><a href="https://ranbook.cloud/tags/microsoft/">Microsoft</a></li>
    </ul>
<nav class="paginav">
  <a class="next" href="https://ranbook.cloud/posts/python-sonarqube-coverage-tests/">
    <span class="title">Next »</span>
    <br>
    <span>Python SonarQube Code Coverage &amp; Quality</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share ASP.NET Core WebAPI Payload Logging with Serilog on x"
            href="https://x.com/intent/tweet/?text=ASP.NET%20Core%20WebAPI%20Payload%20Logging%20with%20Serilog&amp;url=https%3a%2f%2franbook.cloud%2fposts%2fserilog-http-payload-logging%2f&amp;hashtags=aspdotnetcore%2c.net%2cc%23%2cserilog%2chttp%2clogging%2cdotnet%2capi%2cmicrosoft">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share ASP.NET Core WebAPI Payload Logging with Serilog on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2franbook.cloud%2fposts%2fserilog-http-payload-logging%2f&amp;title=ASP.NET%20Core%20WebAPI%20Payload%20Logging%20with%20Serilog&amp;summary=ASP.NET%20Core%20WebAPI%20Payload%20Logging%20with%20Serilog&amp;source=https%3a%2f%2franbook.cloud%2fposts%2fserilog-http-payload-logging%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share ASP.NET Core WebAPI Payload Logging with Serilog on reddit"
            href="https://reddit.com/submit?url=https%3a%2f%2franbook.cloud%2fposts%2fserilog-http-payload-logging%2f&title=ASP.NET%20Core%20WebAPI%20Payload%20Logging%20with%20Serilog">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share ASP.NET Core WebAPI Payload Logging with Serilog on facebook"
            href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2franbook.cloud%2fposts%2fserilog-http-payload-logging%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share ASP.NET Core WebAPI Payload Logging with Serilog on whatsapp"
            href="https://api.whatsapp.com/send?text=ASP.NET%20Core%20WebAPI%20Payload%20Logging%20with%20Serilog%20-%20https%3a%2f%2franbook.cloud%2fposts%2fserilog-http-payload-logging%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share ASP.NET Core WebAPI Payload Logging with Serilog on telegram"
            href="https://telegram.me/share/url?text=ASP.NET%20Core%20WebAPI%20Payload%20Logging%20with%20Serilog&amp;url=https%3a%2f%2franbook.cloud%2fposts%2fserilog-http-payload-logging%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share ASP.NET Core WebAPI Payload Logging with Serilog on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=ASP.NET%20Core%20WebAPI%20Payload%20Logging%20with%20Serilog&u=https%3a%2f%2franbook.cloud%2fposts%2fserilog-http-payload-logging%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2025 <a href="https://ranbook.cloud/">Ranbook Cloud</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
